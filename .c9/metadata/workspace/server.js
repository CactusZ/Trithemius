{"filter":false,"title":"server.js","tooltip":"/server.js","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":40,"column":6},"end":{"row":40,"column":7},"action":"insert","lines":["e"],"id":2650}],[{"start":{"row":40,"column":7},"end":{"row":40,"column":9},"action":"insert","lines":["()"],"id":2651}],[{"start":{"row":40,"column":8},"end":{"row":40,"column":10},"action":"insert","lines":["''"],"id":2652}],[{"start":{"row":40,"column":9},"end":{"row":40,"column":10},"action":"insert","lines":["/"],"id":2653}],[{"start":{"row":40,"column":10},"end":{"row":40,"column":11},"action":"insert","lines":["u"],"id":2654}],[{"start":{"row":40,"column":11},"end":{"row":40,"column":12},"action":"insert","lines":["p"],"id":2655}],[{"start":{"row":40,"column":12},"end":{"row":40,"column":13},"action":"insert","lines":["l"],"id":2656}],[{"start":{"row":40,"column":13},"end":{"row":40,"column":14},"action":"insert","lines":["o"],"id":2657}],[{"start":{"row":40,"column":14},"end":{"row":40,"column":15},"action":"insert","lines":["a"],"id":2658}],[{"start":{"row":40,"column":15},"end":{"row":40,"column":16},"action":"insert","lines":["d"],"id":2659}],[{"start":{"row":40,"column":17},"end":{"row":40,"column":18},"action":"insert","lines":["."],"id":2660}],[{"start":{"row":40,"column":18},"end":{"row":40,"column":19},"action":"insert","lines":[" "],"id":2661}],[{"start":{"row":40,"column":18},"end":{"row":40,"column":19},"action":"remove","lines":[" "],"id":2662}],[{"start":{"row":40,"column":17},"end":{"row":40,"column":18},"action":"remove","lines":["."],"id":2663}],[{"start":{"row":40,"column":17},"end":{"row":40,"column":18},"action":"insert","lines":[","],"id":2664}],[{"start":{"row":40,"column":18},"end":{"row":40,"column":19},"action":"insert","lines":[" "],"id":2665}],[{"start":{"row":40,"column":19},"end":{"row":40,"column":20},"action":"insert","lines":["s"],"id":2666}],[{"start":{"row":40,"column":20},"end":{"row":40,"column":21},"action":"insert","lines":["t"],"id":2667}],[{"start":{"row":40,"column":21},"end":{"row":40,"column":22},"action":"insert","lines":["e"],"id":2668}],[{"start":{"row":40,"column":22},"end":{"row":40,"column":23},"action":"insert","lines":["g"],"id":2669}],[{"start":{"row":40,"column":23},"end":{"row":40,"column":24},"action":"insert","lines":["a"],"id":2670}],[{"start":{"row":40,"column":19},"end":{"row":40,"column":24},"action":"remove","lines":["stega"],"id":2671},{"start":{"row":40,"column":19},"end":{"row":40,"column":31},"action":"insert","lines":["steganograph"]}],[{"start":{"row":40,"column":32},"end":{"row":40,"column":34},"action":"insert","lines":["''"],"id":2672}],[{"start":{"row":40,"column":32},"end":{"row":40,"column":34},"action":"remove","lines":["''"],"id":2673}],[{"start":{"row":40,"column":32},"end":{"row":40,"column":33},"action":"insert","lines":[";"],"id":2674}],[{"start":{"row":42,"column":0},"end":{"row":135,"column":3},"action":"remove","lines":["app.post('/upload/hide', function(req, res) {","","","    var curid = ++id;","    console.log(\"POST request id = \" + curid.toString());","    var objectType;","    var object;","    // create an incoming form object","    var form = new formidable.IncomingForm();","","    // specify that we want to allow the user to upload multiple files in a single request","    form.multiples = true;","","    // store all uploads in the /uploads directory","    form.uploadDir = path.join(__dirname, '/uploads');","","    var resDir = path.join(__dirname, '/results');","    var fileCarrier;","    var fileObject;","    var carrierExt;","    // every time a file has been uploaded successfully,","    // rename it to it's orignal name","    form.on('file', function(field, file) {","        console.log('form field_TYPE=FILE field= ' + field + ' filename=' + file.name);","        var ext = '.' + file.name.split('.').pop();","        if (field == \"fileObject\") {","            fileObject = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","            fs.rename(file.path, path.join(form.uploadDir, fileObject + ext));","            object = path.join(form.uploadDir, fileObject + ext);","        }","        else {","            carrierExt = ext;","            fileCarrier = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","            fileCarrier = path.join(form.uploadDir, fileCarrier + ext);","            fs.rename(file.path, fileCarrier);","","        }","","    });","","    form.on('field', function(field, data) {","        console.log('form field_TYPE=FIELD field= ' + field + ' data=' + data);","        if (field == \"stringObject\") {","            object = data;","        }","        else if (field == \"objectType\") {","            objectType = data;","        }","    });","","    // log any errors that occur","    form.on('error', function(err) {","        console.log('An error has occured: \\n' + err);","    });","","    // once all the files have been uploaded, send a response to the client","    form.on('end', function() {","        console.log('form end ');","        var responseJSON = {};","        if (fileCarrier.split('.').pop() != 'wav') {","            responseJSON[\"status\"] = \"error\";","            responseJSON[\"error\"] = \"wrong data carrier extension\";","            responseJSON[\"error-id\"] = \"1\";","            res.json(responseJSON);","            res.end('success');","            return;","        }","        var resName = crypto.createHash('md5').update(Math.random().toString()).digest('hex') + carrierExt;","        const ls = spawn('java', ['Java/src/steganography_tool/Steganography_Tool', 'Hide', objectType, object, fileCarrier, path.join(resDir, resName)]);","","        ls.stdout.on('data', (data) => {","            console.log(`stdout: ${data}`);","        });","","        ls.stderr.on('data', (data) => {","            console.log(`stderr: ${data}`);","        });","","","        ls.on('close', (code) => {","            responseJSON[\"status\"] = \"success\";","            responseJSON[\"error-id\"] = 0;","            responseJSON[\"result\"] = resName;","            res.json(responseJSON);","            res.end('success');","        });","","","    });","","    // parse the incoming request containing the form data","    form.parse(req);","","});"],"id":2675}],[{"start":{"row":41,"column":0},"end":{"row":42,"column":0},"action":"remove","lines":["",""],"id":2676}],[{"start":{"row":40,"column":33},"end":{"row":41,"column":0},"action":"remove","lines":["",""],"id":2677}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":17},"action":"remove","lines":["/* global next */"],"id":2678}],[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"remove","lines":["",""],"id":2679}],[{"start":{"row":4,"column":2},"end":{"row":5,"column":0},"action":"remove","lines":["",""],"id":2680}],[{"start":{"row":6,"column":0},"end":{"row":8,"column":23},"action":"remove","lines":["var path = require('path');","var formidable = require('formidable');","var fs = require('fs');"],"id":2681}],[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"remove","lines":["",""],"id":2682}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":31},"action":"remove","lines":["var crypto = require('crypto');"],"id":2683}],[{"start":{"row":6,"column":33},"end":{"row":7,"column":0},"action":"remove","lines":["",""],"id":2684}],[{"start":{"row":9,"column":0},"end":{"row":10,"column":45},"action":"remove","lines":["","const spawn = require('child_process').spawn;"],"id":2685}],[{"start":{"row":8,"column":60},"end":{"row":9,"column":0},"action":"remove","lines":["",""],"id":2686}],[{"start":{"row":10,"column":0},"end":{"row":11,"column":11},"action":"remove","lines":["","var id = 0;"],"id":2687}],[{"start":{"row":9,"column":0},"end":{"row":10,"column":0},"action":"remove","lines":["",""],"id":2688}],[{"start":{"row":16,"column":20},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":2689}],[{"start":{"row":8,"column":60},"end":{"row":9,"column":0},"action":"insert","lines":["",""],"id":2690}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":60},"action":"insert","lines":["var steganograph = require('./server_modules/steganograph');"],"id":2691}],[{"start":{"row":9,"column":4},"end":{"row":9,"column":16},"action":"remove","lines":["steganograph"],"id":2692},{"start":{"row":9,"column":4},"end":{"row":9,"column":5},"action":"insert","lines":["f"]}],[{"start":{"row":9,"column":5},"end":{"row":9,"column":6},"action":"insert","lines":["i"],"id":2693}],[{"start":{"row":9,"column":6},"end":{"row":9,"column":7},"action":"insert","lines":["l"],"id":2694}],[{"start":{"row":9,"column":7},"end":{"row":9,"column":8},"action":"insert","lines":["e"],"id":2695}],[{"start":{"row":9,"column":8},"end":{"row":9,"column":9},"action":"insert","lines":["C"],"id":2696}],[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"insert","lines":["o"],"id":2697}],[{"start":{"row":9,"column":10},"end":{"row":9,"column":11},"action":"insert","lines":["n"],"id":2698}],[{"start":{"row":9,"column":11},"end":{"row":9,"column":12},"action":"insert","lines":["t"],"id":2699}],[{"start":{"row":9,"column":12},"end":{"row":9,"column":13},"action":"insert","lines":["r"],"id":2700}],[{"start":{"row":9,"column":13},"end":{"row":9,"column":14},"action":"insert","lines":["o"],"id":2701}],[{"start":{"row":9,"column":14},"end":{"row":9,"column":15},"action":"insert","lines":["l"],"id":2702}],[{"start":{"row":9,"column":15},"end":{"row":9,"column":16},"action":"insert","lines":["l"],"id":2703}],[{"start":{"row":9,"column":16},"end":{"row":9,"column":17},"action":"insert","lines":["e"],"id":2704}],[{"start":{"row":9,"column":17},"end":{"row":9,"column":18},"action":"insert","lines":["r"],"id":2705}],[{"start":{"row":9,"column":47},"end":{"row":9,"column":59},"action":"remove","lines":["steganograph"],"id":2706},{"start":{"row":9,"column":47},"end":{"row":9,"column":48},"action":"insert","lines":["f"]}],[{"start":{"row":9,"column":48},"end":{"row":9,"column":49},"action":"insert","lines":["i"],"id":2707}],[{"start":{"row":9,"column":49},"end":{"row":9,"column":50},"action":"insert","lines":["l"],"id":2708}],[{"start":{"row":9,"column":50},"end":{"row":9,"column":51},"action":"insert","lines":["e"],"id":2709}],[{"start":{"row":9,"column":51},"end":{"row":9,"column":52},"action":"insert","lines":["C"],"id":2710}],[{"start":{"row":9,"column":52},"end":{"row":9,"column":53},"action":"insert","lines":["o"],"id":2711}],[{"start":{"row":9,"column":53},"end":{"row":9,"column":54},"action":"insert","lines":["n"],"id":2712}],[{"start":{"row":9,"column":54},"end":{"row":9,"column":55},"action":"insert","lines":["t"],"id":2713}],[{"start":{"row":9,"column":55},"end":{"row":9,"column":56},"action":"insert","lines":["r"],"id":2714}],[{"start":{"row":9,"column":56},"end":{"row":9,"column":57},"action":"insert","lines":["o"],"id":2715}],[{"start":{"row":9,"column":57},"end":{"row":9,"column":58},"action":"insert","lines":["l"],"id":2716}],[{"start":{"row":9,"column":58},"end":{"row":9,"column":59},"action":"insert","lines":["l"],"id":2717}],[{"start":{"row":9,"column":59},"end":{"row":9,"column":60},"action":"insert","lines":["e"],"id":2718}],[{"start":{"row":9,"column":60},"end":{"row":9,"column":61},"action":"insert","lines":["r"],"id":2719}],[{"start":{"row":27,"column":0},"end":{"row":31,"column":0},"action":"remove","lines":["app.get('/getresult/*.wav', function(req, res) {","    console.log(req.originalUrl);","    res.download('results/' + req.originalUrl.split('/').pop());","});",""],"id":2720},{"start":{"row":27,"column":0},"end":{"row":27,"column":1},"action":"insert","lines":["a"]}],[{"start":{"row":27,"column":1},"end":{"row":27,"column":2},"action":"insert","lines":["p"],"id":2721}],[{"start":{"row":27,"column":2},"end":{"row":27,"column":3},"action":"insert","lines":["p"],"id":2722}],[{"start":{"row":27,"column":3},"end":{"row":27,"column":4},"action":"insert","lines":["."],"id":2723}],[{"start":{"row":27,"column":4},"end":{"row":27,"column":5},"action":"insert","lines":["u"],"id":2724}],[{"start":{"row":27,"column":5},"end":{"row":27,"column":6},"action":"insert","lines":["s"],"id":2725}],[{"start":{"row":27,"column":6},"end":{"row":27,"column":7},"action":"insert","lines":["e"],"id":2726}],[{"start":{"row":27,"column":7},"end":{"row":27,"column":9},"action":"insert","lines":["()"],"id":2727}],[{"start":{"row":27,"column":8},"end":{"row":27,"column":10},"action":"insert","lines":["''"],"id":2728}],[{"start":{"row":27,"column":9},"end":{"row":27,"column":10},"action":"insert","lines":["/"],"id":2729}],[{"start":{"row":27,"column":10},"end":{"row":27,"column":11},"action":"insert","lines":["g"],"id":2730}],[{"start":{"row":27,"column":11},"end":{"row":27,"column":12},"action":"insert","lines":["e"],"id":2731}],[{"start":{"row":27,"column":12},"end":{"row":27,"column":13},"action":"insert","lines":["t"],"id":2732}],[{"start":{"row":27,"column":13},"end":{"row":27,"column":14},"action":"insert","lines":["r"],"id":2733}],[{"start":{"row":27,"column":14},"end":{"row":27,"column":15},"action":"insert","lines":["e"],"id":2734}],[{"start":{"row":27,"column":15},"end":{"row":27,"column":16},"action":"insert","lines":["s"],"id":2735}],[{"start":{"row":27,"column":16},"end":{"row":27,"column":17},"action":"insert","lines":["u"],"id":2736}],[{"start":{"row":27,"column":17},"end":{"row":27,"column":18},"action":"insert","lines":["l"],"id":2737}],[{"start":{"row":27,"column":18},"end":{"row":27,"column":19},"action":"insert","lines":["t"],"id":2738}],[{"start":{"row":27,"column":20},"end":{"row":27,"column":21},"action":"insert","lines":["."],"id":2739}],[{"start":{"row":27,"column":20},"end":{"row":27,"column":21},"action":"remove","lines":["."],"id":2740}],[{"start":{"row":27,"column":20},"end":{"row":27,"column":21},"action":"insert","lines":[","],"id":2741}],[{"start":{"row":27,"column":21},"end":{"row":27,"column":22},"action":"insert","lines":[" "],"id":2742}],[{"start":{"row":27,"column":22},"end":{"row":27,"column":23},"action":"insert","lines":["f"],"id":2743}],[{"start":{"row":27,"column":23},"end":{"row":27,"column":24},"action":"insert","lines":["i"],"id":2744}],[{"start":{"row":27,"column":24},"end":{"row":27,"column":25},"action":"insert","lines":["l"],"id":2745}],[{"start":{"row":27,"column":25},"end":{"row":27,"column":26},"action":"insert","lines":["e"],"id":2746}],[{"start":{"row":27,"column":22},"end":{"row":27,"column":26},"action":"remove","lines":["file"],"id":2747},{"start":{"row":27,"column":22},"end":{"row":27,"column":36},"action":"insert","lines":["fileController"]}],[{"start":{"row":27,"column":37},"end":{"row":27,"column":38},"action":"insert","lines":[";"],"id":2748}],[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"remove","lines":["",""],"id":2749,"ignore":true},{"start":{"row":5,"column":4},"end":{"row":5,"column":11},"action":"remove","lines":["express"]},{"start":{"row":5,"column":4},"end":{"row":5,"column":8},"action":"insert","lines":["http"]},{"start":{"row":5,"column":20},"end":{"row":5,"column":27},"action":"remove","lines":["express"]},{"start":{"row":5,"column":20},"end":{"row":5,"column":24},"action":"insert","lines":["http"]},{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"remove","lines":["",""]},{"start":{"row":6,"column":4},"end":{"row":6,"column":15},"action":"remove","lines":["steganograp"]},{"start":{"row":6,"column":4},"end":{"row":6,"column":7},"action":"insert","lines":["pat"]},{"start":{"row":6,"column":20},"end":{"row":8,"column":0},"action":"remove","lines":["./server_modules/steganograph');","var fileController = require('./server_modules/fileController');",""]},{"start":{"row":6,"column":20},"end":{"row":14,"column":11},"action":"insert","lines":["path');","var formidable = require('formidable');","var fs = require('fs');","var express = require('express');","var crypto = require('crypto');","const spawn = require('child_process').spawn;","","","var id = 0;"]},{"start":{"row":22,"column":0},"end":{"row":23,"column":0},"action":"remove","lines":["",""]},{"start":{"row":30,"column":4},"end":{"row":31,"column":31},"action":"remove","lines":["use('/getresult', fileController);","app.use('/upload', steganograph"]},{"start":{"row":30,"column":4},"end":{"row":211,"column":1},"action":"insert","lines":["get('/getresult/*.wav', function(req, res) {","    console.log(req.originalUrl);","    res.download('results/' + req.originalUrl.split('/').pop());","});","","app.post('/upload/retrieve', function(req, res) {","","    var curid = ++id;","    console.log(\"POST request id = \" + curid.toString());","    var objectType;","","    // create an incoming form object","    var form = new formidable.IncomingForm();","","    // specify that we want to allow the user to upload one file in a single request","    form.multiples = false;","","    // store all uploads in the /uploads directory","    form.uploadDir = path.join(__dirname, '/uploads');","","    var resDir = path.join(__dirname, '/results');","    var fileCarrier;","","    // every time a file has been uploaded successfully,","    // rename it to it's random hashed name","    form.on('file', function(field, file) {","        console.log('form field_TYPE=FILE field= ' + field + ' filename=' + file.name);","        var ext = '.' + file.name.split('.').pop();","        fileCarrier = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","        fileCarrier = path.join(form.uploadDir, fileCarrier + ext);","        fs.rename(file.path, fileCarrier);","    });","","    form.on('field', function(field, data) {","        console.log('form field_TYPE=FIELD field= ' + field + ' data=' + data);","        if (field == \"objectType\") {","            objectType = data;","        }","    });","","    // log any errors that occur","    form.on('error', function(err) {","        console.log('An error has occured: \\n' + err);","    });","","    // once all the files have been uploaded, send a response to the client","    form.on('end', function() {","        console.log('form end ');","        var responseJSON = {};","        if (fileCarrier.split('.').pop() != 'wav') {","            responseJSON[\"status\"] = \"error\";","            responseJSON[\"error\"] = \"wrong data carrier extension\";","            responseJSON[\"error-id\"] = \"1\";","            res.json(responseJSON);","            res.end('success');","            return;","        }","        var resExt = objectType == \"file\" ? \".file\" : \".txt\";","        var resName = crypto.createHash('md5').update(Math.random().toString()).digest('hex') + resExt;","        console.log(\"Retrieve \" + objectType + \" \" + fileCarrier + \" \" + path.join(resDir, resName));","        const ls = spawn('java', ['Java/src/steganography_tool/Steganography_Tool', 'Retrieve', objectType, fileCarrier, path.join(resDir, resName)]);","","        ls.stdout.on('data', (data) => {","            console.log(`stdout: ${data}`);","            responseJSON[\"result\"] = data;","        });","","        ls.stderr.on('data', (data) => {","            console.log(`stderr: ${data}`);","        });","","","        ls.on('close', (code) => {","            responseJSON[\"status\"] = \"success\";","            responseJSON[\"error-id\"] = 0;","            if (objectType == 'file') responseJSON[\"result\"] = resName;","            res.json(responseJSON);","            res.end('success');","        });","","","    });","","    // parse the incoming request containing the form data","    form.parse(req);","","});","","app.post('/upload/hide', function(req, res) {","","","    var curid = ++id;","    console.log(\"POST request id = \" + curid.toString());","    var objectType;","    var object;","    // create an incoming form object","    var form = new formidable.IncomingForm();","","    // specify that we want to allow the user to upload multiple files in a single request","    form.multiples = true;","","    // store all uploads in the /uploads directory","    form.uploadDir = path.join(__dirname, '/uploads');","","    var resDir = path.join(__dirname, '/results');","    var fileCarrier;","    var fileObject;","    var carrierExt;","    // every time a file has been uploaded successfully,","    // rename it to it's orignal name","    form.on('file', function(field, file) {","        console.log('form field_TYPE=FILE field= ' + field + ' filename=' + file.name);","        var ext = '.' + file.name.split('.').pop();","        if (field == \"fileObject\") {","            fileObject = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","            fs.rename(file.path, path.join(form.uploadDir, fileObject + ext));","            object = path.join(form.uploadDir, fileObject + ext);","        }","        else {","            carrierExt = ext;","            fileCarrier = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","            fileCarrier = path.join(form.uploadDir, fileCarrier + ext);","            fs.rename(file.path, fileCarrier);","","        }","","    });","","    form.on('field', function(field, data) {","        console.log('form field_TYPE=FIELD field= ' + field + ' data=' + data);","        if (field == \"stringObject\") {","            object = data;","        }","        else if (field == \"objectType\") {","            objectType = data;","        }","    });","","    // log any errors that occur","    form.on('error', function(err) {","        console.log('An error has occured: \\n' + err);","    });","","    // once all the files have been uploaded, send a response to the client","    form.on('end', function() {","        console.log('form end ');","        var responseJSON = {};","        if (fileCarrier.split('.').pop() != 'wav') {","            responseJSON[\"status\"] = \"error\";","            responseJSON[\"error\"] = \"wrong data carrier extension\";","            responseJSON[\"error-id\"] = \"1\";","            res.json(responseJSON);","            res.end('success');","            return;","        }","        var resName = crypto.createHash('md5').update(Math.random().toString()).digest('hex') + carrierExt;","        const ls = spawn('java', ['Java/src/steganography_tool/Steganography_Tool', 'Hide', objectType, object, fileCarrier, path.join(resDir, resName)]);","","        ls.stdout.on('data', (data) => {","            console.log(`stdout: ${data}`);","        });","","        ls.stderr.on('data', (data) => {","            console.log(`stderr: ${data}`);","        });","","","        ls.on('close', (code) => {","            responseJSON[\"status\"] = \"success\";","            responseJSON[\"error-id\"] = 0;","            responseJSON[\"result\"] = resName;","            res.json(responseJSON);","            res.end('success');","        });","","","    });","","    // parse the incoming request containing the form data","    form.parse(req);","","}"]}],[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":2750,"ignore":true},{"start":{"row":6,"column":4},"end":{"row":6,"column":8},"action":"remove","lines":["http"]},{"start":{"row":6,"column":4},"end":{"row":6,"column":11},"action":"insert","lines":["express"]},{"start":{"row":6,"column":23},"end":{"row":6,"column":27},"action":"remove","lines":["http"]},{"start":{"row":6,"column":23},"end":{"row":6,"column":30},"action":"insert","lines":["express"]},{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"insert","lines":["",""]},{"start":{"row":8,"column":4},"end":{"row":8,"column":7},"action":"remove","lines":["pat"]},{"start":{"row":8,"column":4},"end":{"row":8,"column":15},"action":"insert","lines":["steganograp"]},{"start":{"row":8,"column":28},"end":{"row":16,"column":11},"action":"remove","lines":["path');","var formidable = require('formidable');","var fs = require('fs');","var express = require('express');","var crypto = require('crypto');","const spawn = require('child_process').spawn;","","","var id = 0;"]},{"start":{"row":8,"column":28},"end":{"row":10,"column":0},"action":"insert","lines":["./server_modules/steganograph');","var fileController = require('./server_modules/fileController');",""]},{"start":{"row":18,"column":0},"end":{"row":19,"column":0},"action":"insert","lines":["",""]},{"start":{"row":27,"column":4},"end":{"row":208,"column":1},"action":"remove","lines":["get('/getresult/*.wav', function(req, res) {","    console.log(req.originalUrl);","    res.download('results/' + req.originalUrl.split('/').pop());","});","","app.post('/upload/retrieve', function(req, res) {","","    var curid = ++id;","    console.log(\"POST request id = \" + curid.toString());","    var objectType;","","    // create an incoming form object","    var form = new formidable.IncomingForm();","","    // specify that we want to allow the user to upload one file in a single request","    form.multiples = false;","","    // store all uploads in the /uploads directory","    form.uploadDir = path.join(__dirname, '/uploads');","","    var resDir = path.join(__dirname, '/results');","    var fileCarrier;","","    // every time a file has been uploaded successfully,","    // rename it to it's random hashed name","    form.on('file', function(field, file) {","        console.log('form field_TYPE=FILE field= ' + field + ' filename=' + file.name);","        var ext = '.' + file.name.split('.').pop();","        fileCarrier = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","        fileCarrier = path.join(form.uploadDir, fileCarrier + ext);","        fs.rename(file.path, fileCarrier);","    });","","    form.on('field', function(field, data) {","        console.log('form field_TYPE=FIELD field= ' + field + ' data=' + data);","        if (field == \"objectType\") {","            objectType = data;","        }","    });","","    // log any errors that occur","    form.on('error', function(err) {","        console.log('An error has occured: \\n' + err);","    });","","    // once all the files have been uploaded, send a response to the client","    form.on('end', function() {","        console.log('form end ');","        var responseJSON = {};","        if (fileCarrier.split('.').pop() != 'wav') {","            responseJSON[\"status\"] = \"error\";","            responseJSON[\"error\"] = \"wrong data carrier extension\";","            responseJSON[\"error-id\"] = \"1\";","            res.json(responseJSON);","            res.end('success');","            return;","        }","        var resExt = objectType == \"file\" ? \".file\" : \".txt\";","        var resName = crypto.createHash('md5').update(Math.random().toString()).digest('hex') + resExt;","        console.log(\"Retrieve \" + objectType + \" \" + fileCarrier + \" \" + path.join(resDir, resName));","        const ls = spawn('java', ['Java/src/steganography_tool/Steganography_Tool', 'Retrieve', objectType, fileCarrier, path.join(resDir, resName)]);","","        ls.stdout.on('data', (data) => {","            console.log(`stdout: ${data}`);","            responseJSON[\"result\"] = data;","        });","","        ls.stderr.on('data', (data) => {","            console.log(`stderr: ${data}`);","        });","","","        ls.on('close', (code) => {","            responseJSON[\"status\"] = \"success\";","            responseJSON[\"error-id\"] = 0;","            if (objectType == 'file') responseJSON[\"result\"] = resName;","            res.json(responseJSON);","            res.end('success');","        });","","","    });","","    // parse the incoming request containing the form data","    form.parse(req);","","});","","app.post('/upload/hide', function(req, res) {","","","    var curid = ++id;","    console.log(\"POST request id = \" + curid.toString());","    var objectType;","    var object;","    // create an incoming form object","    var form = new formidable.IncomingForm();","","    // specify that we want to allow the user to upload multiple files in a single request","    form.multiples = true;","","    // store all uploads in the /uploads directory","    form.uploadDir = path.join(__dirname, '/uploads');","","    var resDir = path.join(__dirname, '/results');","    var fileCarrier;","    var fileObject;","    var carrierExt;","    // every time a file has been uploaded successfully,","    // rename it to it's orignal name","    form.on('file', function(field, file) {","        console.log('form field_TYPE=FILE field= ' + field + ' filename=' + file.name);","        var ext = '.' + file.name.split('.').pop();","        if (field == \"fileObject\") {","            fileObject = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","            fs.rename(file.path, path.join(form.uploadDir, fileObject + ext));","            object = path.join(form.uploadDir, fileObject + ext);","        }","        else {","            carrierExt = ext;","            fileCarrier = crypto.createHash('md5').update(Math.random().toString()).digest('hex');","            fileCarrier = path.join(form.uploadDir, fileCarrier + ext);","            fs.rename(file.path, fileCarrier);","","        }","","    });","","    form.on('field', function(field, data) {","        console.log('form field_TYPE=FIELD field= ' + field + ' data=' + data);","        if (field == \"stringObject\") {","            object = data;","        }","        else if (field == \"objectType\") {","            objectType = data;","        }","    });","","    // log any errors that occur","    form.on('error', function(err) {","        console.log('An error has occured: \\n' + err);","    });","","    // once all the files have been uploaded, send a response to the client","    form.on('end', function() {","        console.log('form end ');","        var responseJSON = {};","        if (fileCarrier.split('.').pop() != 'wav') {","            responseJSON[\"status\"] = \"error\";","            responseJSON[\"error\"] = \"wrong data carrier extension\";","            responseJSON[\"error-id\"] = \"1\";","            res.json(responseJSON);","            res.end('success');","            return;","        }","        var resName = crypto.createHash('md5').update(Math.random().toString()).digest('hex') + carrierExt;","        const ls = spawn('java', ['Java/src/steganography_tool/Steganography_Tool', 'Hide', objectType, object, fileCarrier, path.join(resDir, resName)]);","","        ls.stdout.on('data', (data) => {","            console.log(`stdout: ${data}`);","        });","","        ls.stderr.on('data', (data) => {","            console.log(`stderr: ${data}`);","        });","","","        ls.on('close', (code) => {","            responseJSON[\"status\"] = \"success\";","            responseJSON[\"error-id\"] = 0;","            responseJSON[\"result\"] = resName;","            res.json(responseJSON);","            res.end('success');","        });","","","    });","","    // parse the incoming request containing the form data","    form.parse(req);","","}"]},{"start":{"row":27,"column":4},"end":{"row":28,"column":31},"action":"insert","lines":["use('/getresult', fileController);","app.use('/upload', steganograph"]}]]},"ace":{"folds":[],"scrolltop":180,"scrollleft":0,"selection":{"start":{"row":27,"column":4},"end":{"row":27,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":33,"mode":"ace/mode/javascript"}},"timestamp":1475657929768,"hash":"b2ade856bdf03143dad7f20e4213d604fa97ba83"}